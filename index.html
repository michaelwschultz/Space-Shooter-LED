<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://unpkg.com/tachyons/css/tachyons.min.css">
<style>
    .wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
    }
    .hidden {
        visibility: hidden;
    }
</style>

<body class="sans-serif pa2 bg-navy" style="height: 100%; line-height: 0;">

    <div class="wrapper">
        <div>
            <h1 class="lightest-blue pv4 pl2">LED Board Simulator</h1>
            <div id="board-lights" class="absolute"></div>
            <div id="board"></div>
        </div>
    </div>


    <!-- Imports -->
    <script src="simulator.js"></script>
    <script src="classes.js"></script>
    <script src="shapes.js"></script>

    <script>
        //** Variables and setup **//
        let bulletShotOrigin = null;
        let bulletLocation = null;
        let bulletFired = false;
        let bulletCount = 0;
        let shipColor = "";
        let fps = 30;
        let frame = 0;
        let grid = {height: 16, width: 32};

        const ledColor = "bg-dark-blue";

        // render simulator
        getBoard("board", "slot", "bg-dark-blue");
        getBoard("board-lights", "light");

        // setup game objects
        let myShip = new Ship(new Location(6, 0), "bg-yellow");
        let smallShip = new Shape(shapeSmallEnemy, new Location(9, 24));

        // for moveShape, pass in pattern, type object and speed
        smallShip.moveShape([pattern1, pattern2, pattern1], {type: "repeat", number: 3}, 200);

        let largeShip = new Shape(shapeLargeEnemy, new Location(3, 16));
        largeShip.moveShape([pattern2, pattern2, pattern1], {type: "repeat", number: 3}, 300);


        // things to render
        function render(myShip, enemy) {

            // cleanup all unused lights
            for (r = 0; r < grid.height; r++) { 
                for (c = 0; c < grid.width; c++) {
                    let led = (new Location(r, c));
                    turnOff(led);
                }
            }

            // turn on lights in the simulator
            turnOn(myShip.location, myShip.color);

            for (let i = 0; i < smallShip.shapeType.length; i++) {
                turnOn(new Location(smallShip.shapeType[i].row + smallShip.location.row, smallShip.shapeType[i].column + smallShip.location.column), smallShip.shapeType[i].color);
            }

            for (let i = 0; i < largeShip.shapeType.length; i++) {
                turnOn(new Location(largeShip.shapeType[i].row + largeShip.location.row, largeShip.shapeType[i].column + largeShip.location.column), largeShip.shapeType[i].color);
            }
        }

        // render game at designated fps
        setInterval(render.bind(null, myShip), 1000 / fps);


        // keyboard controls
        document.onkeydown = function(e) {
            switch (e.keyCode) {
                case 32: // spacebar
                    new Bullet(myShip.location, "bg-red", 30).fire();
                    break;
                case 38: // up
                    myShip.moveUp();
                    break;
                case 87: // w
                    myShip.moveUp();
                    break;
                case 40: // down
                    myShip.moveDown();
                    break;
                case 83: // s
                    myShip.moveDown();
                    break;
                case 37: // left
                    myShip.moveLeft();
                    break;
                case 39: // right
                    myShip.moveRight();
                    break;
            }
        };

    </script>
</body>